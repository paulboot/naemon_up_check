#!/bin/bash
#
# Took original mail only script from some Nagios book 
# Push-over support using Notify by Pushover by Jedda Wignall

#Add to crontab -e check every 5 minutes
# m h  dom mon dow   command
#*/5 * * * * /usr/local/bin/naemon_up_check >> /var/log/naemon/naemon_up_check.log 2>&1

CONFIG="$HOME/.naemon_up_check.conf"

if [ -r $CONFIG ]; then
        . $CONFIG
else
    echo "Error: file '$CONFIG' does not exist"
    exit 5
fi

INFO=`$NAEMONCHK $PARAMS`
STATUS=$?
 
case $STATUS in
    0) echo "Ok   : " $INFO
        ;;
    *) echo "Error: " $INFO | \
            if [ "$NOTIFYMAIL_ENABLED" = "yes" ]; then
                /usr/bin/mailx -s "Error:Naemon on $(hostname -f) Down." $NOTIFYEMAIL
            fi
            
            if [ "$PUSHOVER_ENABLED" = "yes" ]; then
                /usr/local/bin/notify_by_pushover.sh -u "$PUSHOVER_USERKEY" -a "$PUSHOVER_APPKEY" \
                -c "siren" -w "spacealarm" -o "magic" -t "CRITICAL: Naemon on $(hostname -f) down." \
                -m "Naemon on $(hostname -f) is currently down."
            fi         
        ;;
esac

